## 요구사항 정리 📝


### 문서의 목적

- 이 문서에서는 **[ 16조 - 딜리버리 앱 아웃소싱 팀 프로젝트 ]** 의 요구 사항을 정의합니다.
---

### 문서 기본 정보

- **작성자** : 3BodyProgrammers
- **작성일** : 2025.03.01 (토)
- **수정일** : 2025.03.06 (목)

---

### 로그인 요구사항 - (김유란 작성 2025.03.04)

#### 회원가입
- 이메일, 비밀번호, 이름, 사용자 권한이 존재해야 한다.
- 각 속성의 요구 조건을 하나라도 만족하지 않으면 예외 처리한다. (@Valid)
- 비밀번호는 최소 8글자 이상이며 대소문자 포함 영문 + 숫자 + 특수문자를 최소 1글자씩 포함한다.
- 회원가입 시 일반 유저(USER) 또는 사장님(OWNER)으로 가입할 수 있다.
- 비밀번호는 Bcrypt로 인코딩한다.
- 중복된 이메일로 가입하는 경우 예외 처리한다.
- 가입 성공 시 bearerToken을 반환한다.

#### 로그인
- 가입한 이메일과 비밀번호로 로그인한다.
- 각 속성의 요구 조건을 하나라도 만족하지 않으면 예외 처리한다. (@Valid)
- 가입되지 않은 유저라면 예외 처리한다.
- 비밀번호가 일치하지 않다면 예외 처리한다.
- 로그인 성공 시 bearerToken을 반환한다.

---

### 유저 요구사항 - (김유란 작성 2025.03.04)

#### 내 정보 조회
- 로그인된 유저의 정보를 조회한다.
- 유저를 찾을 수 없다면 예외 처리한다.
- 조회 성공 시 유저 id, 이메일, 이름, 권한, 생성일, 수정일을 반환한다.

#### 내 정보 수정
- 로그인된 유저의 정보를 수정한다.
- 유저를 찾을 수 없다면 예외 처리한다.
- 기존 비밀번호, 새 비밀번호, 이름이 존재해야 한다.
- 각 속성의 요구 조건을 하나라도 만족하지 않으면 예외 처리한다. (@Valid)
- 새 비밀번호가 기존 비밀번호와 같으면 예외 처리한다.
- 기존 비밀번호와 입력한 비밀번호가 일치하지 않으면 예외 처리한다.
- 수정 성공 시 유저 id, 이메일, 이름, 권한, 생성일, 수정일을 반환한다.

#### 회원 탈퇴
- 로그인된 유저를 삭제한다.
- 비밀번호가 존재해야 한다.
- 각 속성의 요구 조건을 하나라도 만족하지 않으면 예외 처리한다. (@Valid)
- 유저를 찾을 수 없다면 예외 처리한다.
- 이미 탈퇴한 유저라면 예외 처리한다.
- 비밀번호가 일치하지 않으면 예외 처리한다.
- 탈퇴한 유저의 이메일은 재사용할 수 없고, 복구할 수 없다.
- 유저 삭제 시 유저의 deletedAt에 현재 시간을 저장한다.
- 탈퇴 성공 시 "회원 탈퇴가 완료되었습니다" 메세지를 반환한다.

---

### 가게 요구사항 - (전탁 작성 2025.03.01)

#### 가게 생성
- 가게 이름, 오픈 시간, 마감 시간, 최소 주문 금액, 가게 공지가 존재 해야 한다.
- 가게 이름, 오픈 시간, 마감 시간, 최소 주문 금액, 가게 공지 중 하나 라도 조건에 맞지 않으면, 예외 처리 한다.(@Valid)
- 가게를 생성 하려는 유저는 반드시 OWNER 여야 한다.
- OWNER는 가게를 최대 3개 까지만 운영 할 수 있다.
- 동일한 이름의 가게가 존재 한다면, 예외 처리 한다.
- 가게가 성공적으로 등록 되면 가게 id, 가게 이름, 오픈 시간, 마감 시간, 최소 주문 금액, 공지, 생성일, 수정일을 담은 dto 객체를 반환 해야 한다.

#### 전체 가게 조회
- 가게 이름, 페이지 번호, 페이지 크기로 조회할 수 있어야 한다.
- 가게 이름, 페이지 번호, 페이지 크기는 선택 사항 이다. -> 기본값을 사용하면 전체, 0번, 10개의 Page 형태로 조회 된다.
- 전체 가게 조회 시에는 메뉴 목록을 함께 볼 수 없다.
- 반환은 가게 id, 가게 이름, 오픈 시간, 마감 시간, 최소 주문 금액, 휴일, 공지, 생성일, 수정일을 반환한다.

#### 단건 가게 조회
- 가게 id를 통해 조회할 수 있어야 한다.
- 가게 조회 시, 전체 메뉴 리스트를 같이 조회 하여야 한다.
- 만약 id에 해당하는 가게가 없다면, 예외 처리 한다.
- 반환은 가게 id, 가게 이름, 오픈 시간, 마감 시간, 최소 주문 금액, 메뉴 리스트, 휴일, 공지, 생성일, 수정일을 반환한다.
- 메뉴 리스트의 메뉴는 메뉴 id, 메뉴 이름, 메뉴 가격을 가지고 있어야 한다.

#### 가게 수정
- 가게 id를 통해 수정할 수 있어야 한다.
- 가게 이름, 오픈 시간, 마감 시간, 최소 주문 금액이 존재 해야 한다.
- 가게 이름, 오픈 시간, 마감 시간, 최소 주문 금액 중 하나 라도 조건에 맞지 않으면, 예외 처리 한다.(@Valid)
- 수정하려는 가게가 없다면 예외처리 한다.
- 가게를 수정 하려는 유저는 반드시 OWNER 여야 한다.
- 수정하려는 OWNER와 가게의 OWNER가 같아야 한다.
- 가게가 성공적으로 수정 되면 가게 id, 가게 이름, 오픈 시간, 마감 시간, 최소 주문 금액, 휴일, 공지, 생성일, 수정일을 담은 dto 객체를 반환 해야 한다.

#### 가게 폐업(삭제)
- 가게 id를 통해 폐업할 수 있어야 한다.
- 폐업하려는 가게가 없다면 예외처리 한다.
- 폐업 요청한 사용자는 반드시 OWNER이어야 한다.
- 폐업하려는 가게의 사장님과 폐업 요청한 사용자가 다르다면 예외처리 한다.
- 폐업하려는 가게가 존재한다면, 가게의 deleted_At에 현재 시간을 저장한다.
- 또한, 해당 가게의 메뉴들도 deleted_At에 현재 시간을 저장한다.

---

### 가게 휴일 요구사항 - (전탁 작성 2025.03.02)

#### 가게 휴일 수정
- 가게 휴일에 해당하는 값이 존재해야 한다.
- 해당 값들은 비트마스킹을 사용해 하나의 정수로 표현해야 한다.
- 월,화,수,목,금,토,일 이 아닌 값이 들어오면 예외처리 해야한다.
- id에 해당하는 가게가 존재하지 않는다면 예외 처리 한다.
- 휴일 수정한 요청자가 OWNER가 아니라면 예외 처리 한다.
- 휴일 수정을 요청한 사용자가 가게 사장님이 아니라면 에외 처리 한다.
- 비트마스킹 된 값으로 휴일을 업데이트 한다.
- 업데이트 이후 가게 id, 가게 이름, 오픈 시간, 마감 시간, 최소 주문 금액, 휴일, 생성일, 수정일을 반환 해야 한다.

#### 휴일과 비트마스킹된 값 변환
- 휴일에 대한 값과 비트마스킹 된 값은 서로 변환이 되어야 한다.
- 월 : 1, 화 : 2, 수 : 4, 목 : 8, 금 : 16, 토 : 32, 일 : 64
- EX) 월 수가 휴일이라면 비트마스킹 된 값은 5 이다.
- EX) 비트마스킹 된 값이 12라면, 휴일은 수 목 이다.

---

### 메뉴 요구사항 - (전탁 작성 2025.03.03)

#### 메뉴 생성
- 메뉴 이름, 가격이 존재해야 한다.
- 요청한 유저가 사장님이 아닌 경우 예외 처리 한다.
- 해당 가게가 존재하지 않는 경우 예외 처리 한다.
- 요청한 유저와 가게의 사장님이 일치하지 않는 경우 예외 처리 한다.
- 메뉴 테이블에 해당 정보를 저장한다.
- 반환 시 메뉴 id, 메뉴 이름, 메뉴 가격, 생성일, 수정일을 반환해야 한다.

#### 메뉴 수정
- 메뉴 이름, 가격이 존재해야 한다.
- 요청한 유저가 사장님이 아닌 경우 예외 처리 한다.
- 해당 가게가 존재하지 않는 경우 예외 처리 한다.
- 요청한 유저와 가게의 사장님이 일치하지 않는 경우 예외 처리 한다.
- 해당 메뉴가 존재하지 않는 경우 예외 처리 한다.
- 메뉴를 업데이트 한다.
- 반환 시 메뉴 id, 메뉴 이름, 메뉴 가격, 생성일, 수정일을 반환해야 한다.

#### 메뉴 삭제
- 메뉴 이름, 가격이 존재해야 한다.
- 요청한 유저가 사장님이 아닌 경우 예외 처리 한다.
- 해당 가게가 존재하지 않는 경우 예외 처리 한다.
- 요청한 유저와 가게의 사장님이 일치하지 않는 경우 예외 처리 한다.
- 해당 메뉴가 존재하지 않는 경우 예외 처리 한다.
- 메뉴의 deletedAt을 요청 시간으로 업데이트 한다.
- "해당 메뉴가 삭제 되었습니다." 메시지를 반환 해야 한다.

---

### 주문 요구사항 - (김지영 작성 2025.03.02)

#### 주문 생성
- 주문 생성 요청은 USER의 계정이어야 한다.
- 주문은 최소 금액을 충족시켜야 한다.
- 주문 생성은 휴일이 아닌 날, 가게의 오픈 시간과 마감 시간 이내에 가능하다.
- 주문 메뉴는 해당 가게의 메뉴만 가능하며 하나의 메뉴만 주문할 수 있다.
- 폐업한 가계에서는 주문이 불가능하다.
- 위 조건 중 하나라도 부합하지 않으면 예외처리한다.
- 주문이 성공적으로 요청되면 주문 id, 가게 id, 메뉴 이름, 가격, 주문상태, 생성일, 수정일을 담은 dto 객체를 반환 해야 한다.

#### 주문 상태 변경
- OWNER는 주문 취소, 주문 수락(조리중), 배송시작, 완료 등의 상태변경이 가능하다.
- USER는 OWNER가 주문 수락을 하기 전에 주문 취소가 가능하다.
- OWNER는 자기 가게에 대한 주문상태를 변경할 수 있다.
- 주문요청 성공 또는 OWNER가 주문상태 변경을 성공했을 시 주문 id, USER id, 가게 id, 메뉴이름, 가격, 주문상태, 생성일, 수정일을 반환한다.(AOP 로그 반환)

#### 전체 주문 조회
- 주문 내역 리스트는 전체, 0번, 10개의 Page 형태로 조회된다.
- 각 주문 리스트는 주문 id, USER id, 가게 id, 메뉴이름, 가격, 주문상태, 생성일, 수정일을 반환한다.

#### 단건 주문 조회
- 주문 id를 통해 조회된다.
- 만약 id에 해당하는 주문이 없다면, 예외 처리 한다.
- 반환은 주문 id, USER id, 가게 id, 메뉴이름, 가격, 주문상태, 생성일, 수정일을 반환한다.

#### 주문 취소
- 주문 id를 통해 취소 할 수 있어야 한다.
- USER의 경우 주문 수락 상태 이전에만 취소가 가능하다.
- 가게 이름, 오픈 시간, 마감 시간, 최소 주문 금액 중 하나 라도 조건에 맞지 않으면, 예외 처리 한다.(@Valid)
- 취소하려는 주문이 없다면 예외처리 한다.
- USER는 해당 가게 OWNER의 수락 이전에만 취소가 가능하다.
- 주문 취소 시 OWNER와 가게의 OWNER가 같아야 한다.
- 주문이 취소 된 경우 주문 취소 성공 메세지가 반한된다. // 헷갈림

---

### 리뷰 요구사항 - (김유란 작성 2025.03.05)

#### 리뷰 생성
- 별점, 평가가 존재해야 한다.
- 각 속성의 요구 조건을 하나라도 만족하지 않으면 예외 처리한다. (@Valid)
- 별점은 1~5 사이의 값을 가진다.
- OWNER는 리뷰를 작성할 수 없다.
- 이미 리뷰가 작성된 적 있는 주문이면 예외 처리한다.
- 배달 완료된 주문에만 리뷰를 작성할 수 있다.
- 가게가 존재하지 않거나 삭제되었으면 예외 처리한다.
- 주문에 대한 리뷰가 이미 존재하면 예외 처리한다.
- 생성 성공 시 id, userId, storeId, orderId, 별점, 평가, 생성일, 수정일을 반환한다.

#### 리뷰 조회
- 모든 유저는 가게 정보 기준으로 리뷰를 다건 조회할 수 있다.
- 가게가 존재하지 않거나 삭제되었으면 예외 처리한다.
- 페이지 번호, 페이지 크기로 조회할 수 있어야 한다.
- 별점 범위에 따라 조회할 수 있어야 한다.
- 리뷰 조회 시 리뷰 생성일을 기준으로 내림차순 정렬된다.
- 조회 시 [id, userId, storeId, orderId, 별점, 평가, 생성일, 수정일]이 페이지 형태로 반환되고, 리뷰 총 개수와 별점 평균이 함께 반환된다.

#### 리뷰 수정
- 별점, 평가가 존재해야 한다.
- 각 속성의 요구 조건을 하나라도 만족하지 않으면 예외 처리한다. (@Valid)
- OWNER는 리뷰를 수정할 수 없다.
- 가게가 존재하지 않거나 삭제되었으면 예외 처리한다.
- 리뷰를 찾을 수 없거나 삭제된 리뷰면 예외 처리한다.
- 본인이 작성한 리뷰만 수정할 수 있다.
- 수정 성공 시 id, userId, storeId, orderId, 별점, 평가, 생성일, 수정일을 반환한다.

#### 리뷰 삭제
- OWNER는 리뷰를 삭제할 수 없다.
- 가게가 존재하지 않거나 삭제되었으면 예외 처리한다.
- 리뷰를 찾을 수 없거나 이미 삭제된 리뷰면 예외 처리한다.
- 본인이 작성한 리뷰만 삭제할 수 있다.
- 리뷰 삭제 시 해당 주문에 다시 리뷰를 생성할 수 없다.
- 리뷰 삭제 시 리뷰의 deletedAt에 현재 시간을 저장한다.
- 삭제 성공 시 "리뷰 삭제가 완료되었습니다." 메세지를 반환한다.

---

### 통합 검색 요구사항 - (전탁 작성 2025.03.05)

#### 통합 검색
- 쿼리파라미터로 가게 이름 or 메뉴 명이 필수적으로 존재해야 한다.
- 만약 존재하지 않거나, 비어있거나, 공백이라면, 예외처리 한다.
- 가게 이름에 해당 값이 포함된 가게를 조회한다.
- 메뉴 이름에 해당 값이 포함된 메뉴를 조회한다.
- 조회한 메뉴에 해당하는 가게들을 추가한다.
- 조회된 가게들을 Page 객체로 처리하여 반환해야 한다.

---

### 가게 대시 보드 요구사항 - (전탁 작성 2025.03.05)

#### 일별 통계
- 특정일이 존재해야 한다.
- 해당일이 현재일 기준 미래 라면, 예외 처리 해야 한다.
- 해당 가게가 존재하지 않는다면, 예외 처리 해야 한다.
- 해당 가게의 사장님과 요청한 사장님이 다를 경우 예외 처리 해아 한다.
- 특정 일의 모든 주문을 조회하여 일 고객, 일 매출을 구하고 반환한다.

#### 기간별 통계
- 시작일, 종료일이 존재해야 한다.
- 종료일이 현재 일 기준 미래 라면, 예외 처리 해야 한다.
- 시작일이 종료일보다 미래라면, 예외 처리 해야 한다.
- 해당 가게가 존재하지 않는다면, 예외 처리 해야 한다.
- 해당 가게의 사장님과 요청한 사장님이 다를 경우 예외 처리 해아 한다.
- 각 일별 일 고객, 일 매출을 List<Dto> 형태로 구한다.
- 전체 고객, 전체 매출을 구한다.
- 전체 고객, 전체 매출, 일별 (고객,매출) List를 반환한다.

---